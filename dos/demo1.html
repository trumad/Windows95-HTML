<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Dostoy DOS-prompt demo</title>
    <style>
        body, html {
            margin: 0px;
        }

        main {
            position: absolute;
            background-color: #000;

            width: 100%;
            height: 100%;
        }

        #mobileInput {
            position: absolute;
            top: -5px;
            left: -5px;
            width: 0px;
            height: 0px;
        }

    </style>
<body>
<main>
    <canvas id="viewPort" width="1024" height="768"></canvas>
    <input id="mobileInput" type="text">

</main>

<script src="dostoy.js"></script>
<script>

    var repeat = function (text, num) {
        return new Array(num + 1).join(text);
    }

    window.onload = function () {

        dostoy.init({
            font: window.atob("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AAAYGBgYGBgY/wAAAAAAAAAAAAAAAAD/GBgYGBgYGBgYGBgYGB8YGBgYGBgAAAAAAAAA/wAAAAAAABgYGBgYGBj/GBgYGBgYGBgYGBgfGB8YGBgYGBg2NjY2NjY2NzY2NjY2NjY2NjY2NzA/AAAAAAAAAAAAAAA/MDc2NjY2NjY2NjY2NvcA/wAAAAAAAAAAAAAA/wD3NjY2NjY2NjY2NjY3MDc2NjY2NjYAAAAAAP8A/wAAAAAAADY2NjY29wD3NjY2NjY2GBgYGBj/AP8AAAAAAAA2NjY2NjY2/wAAAAAAAAAAAAAA/wD/GBgYGBgYAAAAAAAAAP82NjY2NjY2NjY2NjY2PwAAAAAAABgYGBgYHxgfAAAAAAAAAAAAAAAfGB8YGBgYGBgAAAAAAAAAPzY2NjY2NjY2NjY2Njb/NjY2NjY2GBgYGBj/GP8YGBgYGBgYGBgYGBgY+AAAAAAAAAAAAAAAAAAfGBgYGBgY//////////////////8AAAAAAAAA//////////Dw8PDw8PDw8PDw8PDwDw8PDw8PDw8PDw8PDw//////////AAAAAAAAAAAAAAAAdtzY2Nx2AAAAAAAAAHzG/MbG/MDAQAAAAP7GxsDAwMDAwAAAAAAAAAD+bGxsbGxsAAAAAAD+xmAwGDBgxv4AAAAAAAAAAH7Y2NjYcAAAAAAAAABmZmZmfGBgwAAAAAAAAHbcGBgYGBgAAAAAAH4YPGZmZjwYfgAAAAAAOGzGxv7Gxmw4AAAAAAA4bMbGxmxsbO4AAAAAAB4wGAw+ZmZmPAAAAAAAAAAAftvbfgAAAAAAAAADBn7b2/N+YMAAAAAAABwwYGB8YGAwHAAAAAAAAHzGxsbGxsbGAAAAAAAA/gAA/gAA/gAAAAAAAAAYGH4YGAAA/wAAAAAAMBgMBgwYMAB+AAAAAAAMGDBgMBgMAH4AAAAAAA4bGxgYGBgYGBgYGBgYGBgYGBgY2NhwAAAAAAAAGBgAfgAYGAAAAAAAAAAAdtwAdtwAAAAAAAA4bGw4AAAAAAAAAAAAAAAAAAAAGBgAAAAAAAAAAAAAAAAAGAAAAAAAAAAPDAwMDAzsbDwcAAAAANhsbGxsbAAAAAAAAAAAcNgwYMj4AAAAAAAAAAAAAAB8fHx8fHwAAAAAAAAAAAAAAAAAAAAAAAA="),
            fontHeight: 14,
            canvas: document.getElementById("viewPort"),
            shell: true,
            beforeShell: function () {
                dostoy.color(6, 15);
                dostoy.println(dostoy.chr("201" + repeat(",205", 34) + ",187"));
                dostoy.println(dostoy.chr("186") + " SomeSoft SomeThing v1.0 (c) 2014 " + dostoy.chr("186"))
                dostoy.println(dostoy.chr("200" + repeat(",205", 34) + ",188"));
                dostoy.color(0, 7);
                dostoy.println();
            },
            prompt: "C:\\>",
            commandHandler: function (command) {
                var rootCommand = command.split(" ");

                switch (rootCommand[0]) {
                    case "cls":
                        dostoy.cls();
                        break;
                    case "dir":
                        dostoy.println();
                        var colordemo = "colordemo.exe";
                        for (var i = 0; i < colordemo.length; i++) {
                            dostoy.color(0, i + 2);
                            dostoy.print(colordemo[i]);
                        }
                        dostoy.color(0, 7);

                        dostoy.println(" - I can see colors!");
                        dostoy.println("guessnumber.exe - Guess the number game")
                        dostoy.println("menu.exe      - An interactive menu demo");
                        dostoy.println("keyprint.exe  - Print key codes (for dev)");
                        dostoy.println();
                        dostoy.println("getsource.exe - redirect: GitHub for this dos toy")

                        dostoy.println();

                        break;
                    case "format":
                        dostoy.println("I'm sorry Dave, I'm afraid I can't do that.");
                        break;
                    case "ver":
                        dostoy.println("Toolsley.com DosToy - a silly interactive retro console interpreter for the HTML5 canvas");
                        break;
                    case "colordemo":
                    case "colordemo.exe":
                        for (var i = 0; i <= 15; i++) {
                            for (var j = 0; j <= 15; j++) {
                                dostoy.color(i, j);
                                dostoy.print(i + "," + j);
                            }
                            dostoy.println();
                        }

                        dostoy.color(0, 7);
                        break;
                    case "getsource":
                    case "getsource.exe":
                        dostoy.setCursor(false);
                        dostoy.setPrompt("");
                        dostoy.println(" Redirecting ...");
                        window.location = "https://github.com/toolsley/dostoy";
                        break;

                    case "guessnumber":
                    case "guessnumber.exe":
                        var myNumber = Math.floor((Math.random() * 10) + 1);
                        var numberGuessHandler = function (number) {
                            if (number == myNumber) {
                                dostoy.println("You got it!")

                            } else {
                                if (number > myNumber) dostoy.println("It's LESS than that");
                                if (number < myNumber) dostoy.println("It's MORE than that");
                                dostoy.input("Next guess? ", numberGuessHandler);
                            }

                        }

                        dostoy.input("I thought of a number between 1 and 10. What could it be? ", numberGuessHandler);
                        break;
                    case "menu":
                    case "menu.exe":
                        var activeItem =0;
                        var menuTitle = "Menu demo";
                        var menuItems = ["Hello","World","Alpha","Beta","Gamma","Exit"];
                        var menuWidth = 20;

                        dostoy.setShell(false);
                        dostoy.setCursor(false);
                        dostoy.cls();

                        var printMenu = function(width, title, items, activeItem) {
                            dostoy.locate(5,5);
                            var titleGap = Math.floor((menuWidth-title.length-6)/2);
                            dostoy.color(2,15);
                            dostoy.print(dostoy.chr("218,"+repeat("196,",title.length%2==0?titleGap-1:titleGap)+"180"));
                            dostoy.print(" "+title+" ");
                            dostoy.print(dostoy.chr("195,"+repeat("196,",Math.floor((menuWidth-title.length-6)/2))+"191"));
                            for (var i=0;i<items.length;i++) {
                                dostoy.locate(5,6+i);
                                var gap = Math.floor((menuWidth-items[i].length-2)/2);
                                dostoy.print(dostoy.chr("179"));
                                if (i == activeItem) dostoy.color(1,15);
                                dostoy.print(repeat(" ",items[i].length%2==0?gap-1:gap));
                                (i == activeItem) ? dostoy.color(1,14) : dostoy.color(2,14);
                                dostoy.print(items[i].substr(0,1));
                                (i == activeItem) ? dostoy.color(1,15) : dostoy.color(2,15);
                                dostoy.print(items[i].substr(1));
                                dostoy.print(repeat(" ",gap));
                                dostoy.color(2,15)
                                dostoy.print(dostoy.chr("179"));
                            }
                            dostoy.locate(5,6+items.length);
                            dostoy.print(dostoy.chr("192,"+repeat("196,",width-3)+"217"))
                        }


                        var menunavi = function (code) {

                            switch (code) {
                                case 38:  // up
                                        if (activeItem>0) activeItem--;
                                    break;
                                case 40: // down
                                        if (activeItem<menuItems.length-1) activeItem++;
                                    break;
                                case 13:
                                    if (activeItem==menuItems.length -1) {
                                        dostoy.setCursor(true);
                                        dostoy.setShell(true)
                                        return;
                                    } else {
                                        dostoy.locate(1,1);
                                        dostoy.color(0,15);
                                        dostoy.println("Selected: "+menuItems[activeItem]+"        ");
                                    }
                            }

                            dostoy.inkey(menunavi);
                            printMenu(menuWidth,menuTitle,menuItems,activeItem);
                        }

                        printMenu(menuWidth,menuTitle,menuItems,activeItem);
                        dostoy.inkey(menunavi);

                        break;
                    case "keyprint":
                    case "keyprint.exe":

                        dostoy.println("Press some keys and I'll tell you the keycodes. Press Enter to end");
                        dostoy.setShell(false);

                        var keyprinter = function (code) {
                            dostoy.println(code);
                            if (code == 13) {
                                dostoy.setShell(true)
                            } else {
                                dostoy.inkey(keyprinter);
                            }
                        }
                        dostoy.inkey(keyprinter);
                        break;
                    default:
                        dostoy.println("Bad command or filename")

                }

            }
        });
    };
    window.onunload = function () {
        location.reload();
    }

    document.getElementById("viewPort").addEventListener("click", function (evt) {
        document.getElementById("mobileInput").focus();
    });


</script>
</body>
</html>